# lofi.md Roadmap

> LLM-first wireframe DSL. Part of the moo.md ecosystem.

## Phase 1: Ruthless MVP

### Identity

| Aspect | Value |
|--------|-------|
| **Package** | `lofi` |
| **Extension** | `.lofi` |
| **CLI** | `lofi` |
| **Brand** | lofi.md |

---

### Tech Stack (Decided)

| Component | Choice | Rationale |
|-----------|--------|-----------|
| **Parser** | Langium | LSP for free, IndentationAwareTokenBuilder, future-proof |
| **Package manager** | bun | Fast, simple, matches moo.md ecosystem |
| **Bundler** | tsup | Simple, fast, ESM + CJS |
| **Test runner** | Vitest | Fast, ESM-native, good DX |
| **Linting** | Biome | Fast, all-in-one (format + lint) |
| **Markdown parser** | remark | For `md` blocks, battle-tested |

---

### Monorepo Structure

```
lofi/
├── .claude/
│   ├── CLAUDE.md              # Project instructions for Claude
│   └── rules/
│       ├── langium.md         # Langium-specific rules
│       └── testing.md         # Testing requirements
├── packages/
│   ├── language/              # Langium grammar + language server
│   │   ├── src/
│   │   │   ├── lofi.langium   # Grammar definition
│   │   │   ├── main.ts        # Language server entry
│   │   │   └── generator.ts   # AST → HTML generator
│   │   └── package.json
│   ├── cli/                   # CLI tool
│   │   ├── src/
│   │   │   ├── index.ts       # CLI entry
│   │   │   └── server.ts      # Dev server with hot reload
│   │   └── package.json
│   └── vscode/                # VS Code extension (Phase 2)
│       └── package.json
├── test-cases/                # Validation test cases (.lofi files)
├── examples/                  # Canonical examples
├── PHILOSOPHY.md
├── SYNTAX.md
├── ROADMAP.md
├── biome.json
├── package.json               # Workspace root
└── tsconfig.json
```

---

### Milestones

#### Milestone 1: Syntax Validation ✅
- [x] Write formal syntax spec
- [x] Create 10 test case files
- [x] Run LLM validation tests
- [x] **Result: 100% parse success (10/10)**

#### Milestone 2: Repo Scaffolding
- [ ] Initialize bun workspace monorepo
- [ ] Create packages/language structure
- [ ] Create packages/cli structure
- [ ] Set up Langium project (`npm init langium`)
- [ ] Configure TypeScript (tsconfig.json)
- [ ] Configure Biome (biome.json)
- [ ] Set up Vitest
- [ ] Create `.claude/CLAUDE.md` with project rules
- [ ] Create `.claude/rules/langium.md`
- [ ] Create `.claude/rules/testing.md`

#### Milestone 3: Langium Grammar
- [ ] Define `lofi.langium` grammar
- [ ] Implement IndentationAwareTokenBuilder
- [ ] Define AST node types
- [ ] Handle `md` blocks (delegate to remark)
- [ ] Handle `html` blocks (passthrough)
- [ ] Unit tests for all 10 test cases
- [ ] Error messages with line numbers

#### Milestone 4: HTML Generator
- [ ] Create generator.ts (AST → HTML)
- [ ] Implement sketch style CSS
- [ ] Handle all element types
- [ ] Unit tests for renderer

#### Milestone 5: CLI + Server
- [ ] `lofi <input.lofi>` → HTML output
- [ ] `lofi --watch` → file watcher
- [ ] `lofi --serve` → dev server with hot reload
- [ ] Create bin/lofi entry point
- [ ] Publish to npm

#### Milestone 6: LSP + Tooling
- [ ] VS Code extension (packages/vscode)
- [ ] Syntax highlighting (TextMate grammar auto-generated by Langium)
- [ ] Autocomplete for element keywords
- [ ] Hover docs for attributes
- [ ] Diagnostics (errors shown in editor)

#### Milestone 7: Documentation
- [x] PHILOSOPHY.md
- [ ] SYNTAX.md (complete reference)
- [ ] README.md (quick start)
- [ ] 5 canonical examples

#### Milestone 8: Upstream Reference
- [ ] Document original wiremd nesting issue
- [ ] Note: lofi syntax solves this with indentation

---

## Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Primitives | 3: `container`, `control`, `content` | Minimal; visual variants not categories |
| Vocabulary | Domain keywords as sugar over primitives | Friendly syntax, extensible internals |
| Syntax | Fresh design | Current wiremd has broken abstractions |
| Keywords | English words | Anka research: 99.9% LLM parse success |
| Nesting | Indentation-based | Validated: 100% test success |
| Attributes | Named `key=value` | Explicit, unambiguous |
| Markdown | Native `md` block | Tables, lists, dividers — don't reinvent |
| HTML | Escape hatch `html` block | Only for elements not in vocabulary |
| Style | Sketch only | Single style |
| Output | HTML only | No React/Tailwind |
| Icons | Phosphor | Clean, MIT |
| Tables | Markdown in `md` block | Keep remark-gfm |
| Parser | Langium | LSP for free, indentation support built-in |

---

## Langium Grammar Preview

```langium
grammar Lofi

entry Document: elements+=Element*;

Element:
    keyword=KEYWORD attrs+=Attribute*
    (INDENT children+=(Element | MdBlock | HtmlBlock)* DEDENT)?;

MdBlock: 'md' (INDENT content=MD_CONTENT DEDENT | ':' content=MD_INLINE);
HtmlBlock: 'html' INDENT content=HTML_CONTENT DEDENT;

Attribute:
    name=ID '=' value=(STRING | ID) |
    name=ID;  // boolean flag like "primary" or "disabled"

// Keywords map to 3 primitives in AST:
// container: page|section|card|grid|modal|nav|tabs|menu|form|alert|breadcrumb
// control:   button|input|checkbox|radio|dropdown|textarea|link|tab|accordion|toggle|slider
// content:   heading|text|image|icon|badge|toast|avatar|progress|chart
terminal KEYWORD: /page|section|card|grid|heading|text|image|icon|link|form|input|button|checkbox|radio|dropdown|textarea|alert|badge|modal|toast|nav|breadcrumb|tabs|tab|menu|accordion|toggle|slider|avatar|progress|chart|md|html/;
terminal ID: /[a-zA-Z_][a-zA-Z0-9_-]*/;
terminal STRING: /"[^"]*"/;
terminal INDENT: 'synthetic:indent';
terminal DEDENT: 'synthetic:dedent';
hidden terminal WS: /[\t ]+/;
hidden terminal NL: /[\r\n]+/;
```

---

## Sources

- [Langium Indentation Guide](https://langium.org/docs/recipes/lexing/indentation-sensitive-languages/)
- [Anka DSL Research](https://arxiv.org/html/2512.23214) — LLM-optimized DSL principles
- [PlantUML Salt](https://plantuml.com/salt) — Prior art
